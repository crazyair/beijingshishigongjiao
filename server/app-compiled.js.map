{"version":3,"sources":["app.js"],"names":[],"mappings":"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","file":"app-compiled.js","sourcesContent":["const Server = require('./server.js');\r\nconst port = (process.env.PORT || 8081);\r\nconst app = Server.app();\r\n\r\nconst cheerio = require('cheerio');\r\nconst superagent = require('superagent');\r\n\r\nvar ck = '';\r\n\r\napp.all('*', function (req, res, next) {\r\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\r\n    // res.header(\"Access-Control-Allow-Headers\", \"Content-Type,Content-Length, Authorization, Accept,X-Requested-With\");\r\n    res.header('Access-Control-Allow-Headers', 'Content-Type, Content-Length, Authorization, Accept, X-Requested-With');\r\n    res.header(\"Access-Control-Allow-Methods\", \"PUT,POST,GET,DELETE,OPTIONS\");\r\n    res.header('Access-Control-Allow-Credentials', true);//告诉客户端可以在HTTP请求中带上Cookie\r\n    // res.header(\"X-Powered-By\", ' 3.2.1')\r\n    res.header(\"X-Powered-By\", 'PHP/5.2.5')\r\n    res.header(\"Content-Type\", \"application/json;charset=utf-8\");\r\n    // res.header(\"Content-Type\", \"text/html\");\r\n    res.header(\"Pragma\", \"no-cache\");\r\n    // res.header(\"Set-Cookie\", 'SERVERID=c40443f9636cc324fbdb5c25c09256b6|1471397374|1471397213;Path=/')\r\n    next();\r\n});\r\n\r\napp.get('/api', function (req, res, next) {\r\n    superagent.get('https://cnodejs.org/')\r\n        .end(function (err, sres) {\r\n            if (err) {\r\n                return next(err);\r\n            }\r\n            var $ = cheerio.load(sres.text);\r\n            var items = [];\r\n            $('#topic_list .cell').each(function (idx, element) {\r\n                var $element = $(element).find('.topic_title');\r\n                var $element2 = $(element).find('.last_active_time');\r\n                items.push({\r\n                    title: $element.attr('title'),\r\n                    href: $element.attr('href'),\r\n                    text: $element2.text()\r\n                });\r\n            });\r\n            res.send(items);\r\n        });\r\n});\r\n\r\napp.get('/get', function (req, res, next) {\r\n    getCk(req, res, next);\r\n});\r\nfunction getCk(req, res, next) {\r\n    superagent.get('http://www.bjbus.com/home/index.php')\r\n        .end(function (err, sres) {\r\n            if (err) {\r\n                return next(err);\r\n            }\r\n            console.log(111, sres.header['set-cookie']);\r\n            ck = sres.header['set-cookie'];\r\n            ck = ck.join('').replace('path=/', '').replace('Path=/', '');\r\n            res.send(sres.header);\r\n        });\r\n}\r\napp.get('/bj', function (req, res, next) {\r\n    // console.log(req);\r\n    // console.log(req.query);\r\n    superagent.get('http://www.bjbus.com/home/ajax_search_bus_stop_token.php?act=busTime&selBLine=1&selBDir=5276138694316562750&selBStop=1')\r\n        .withCredentials()\r\n        .set('X-Requested-With', 'XMLHttpRequest')\r\n        // .set('Cookie', 'PHPSESSID=4a1b39ebfed819523e27ee4f728dfdaf; SERVERID=ebcde74858922aec8aaf8fb40aed60362;')\r\n        // .set('Cookie', ck)\r\n        .set('Cookie', 'PHPSESSID=056407d382622455fe967c07d973efa7;SERVERID=b6e721ca8fa8f1065ade14ce5cd80b3a|1471708800|1471536000;Hm_lpvt_2c630339360dacc1fc1fd8110f283748=1471405742;Hm_lvt_2c630339360dacc1fc1fd8110f283748=1470987371,1471397218')\r\n        .set('user-agent', 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36')\r\n        .end(function (err, sres) {\r\n            if (err) {\r\n                return next(err);\r\n            }\r\n            // console.log(111,JSON.parse(sres.text).html)\r\n            // console.log(sres.text);\r\n            if (sres.text == 'timeout') {\r\n                return res.send(sres);\r\n            }\r\n            // var d=Object.parse(sres);\r\n            const html = JSON.parse(sres.text).html;\r\n            const $ = cheerio.load(html);\r\n            // console.log($('.inquiry_header #lh').text())\r\n            const data = {\r\n                numRoad: $('.inquiry_header #lh').text()\r\n                , numRoadDec: $('.inner #lm').text()\r\n                , numRoadDec2: $('.inner article').text()\r\n            }\r\n\r\n            // res.send(html);\r\n            res.send(JSON.stringify(data));\r\n        });\r\n});\r\napp.get('/test', function (req, res, next) {\r\n    // seq:12\r\n    // w 572\r\n    const $ = cheerio.load('<div class=\"inquiry_header\"><div class=\"left fixed\"><h3 id=\"lh\">2路</h3></div><div class=\"inner\"><h2 id=\"lm\">海户屯-宽街路口南</h2><article><p>宽街路口南&nbsp;5:00-23:00&nbsp;分段计价&nbsp;所属电车分公司</p><p>最近一辆车距离此还有&nbsp;0&nbsp;站，&nbsp;<span>649</span>&nbsp;米，预计到站时间&nbsp;<span>2</span>&nbsp;分钟</p></article></div></div><div id=\"cc_stop\" class=\"inquiry_main\" unselectable=\"on\" onselectstart=\"return false;\"><ul class=\"fixed\"><li><div id=\"1\"><i></i><p class=\"sicon\"></p><span title=\"海户屯\">海户屯</span></div></li><li><div id=\"2m\"><i ></i></div></li><li><div id=\"2\"><i class=\"buss\" clstag=\"-1\"></i><p class=\"sicon\"></p><span title=\"木樨园桥北\">木樨园桥北</span></div></li><li><div id=\"3m\"><i ></i></div></li><li><div id=\"3\"><i></i><p class=\"sicon\"></p><span title=\"沙子口\">沙子口</span></div></li><li><div id=\"4m\"><i ></i></div></li><li><div id=\"4\"><i></i><p class=\"sicon\"></p><span title=\"永定门内\">永定门内</span></div></li><li><div id=\"5m\"><i ></i></div></li><li><div id=\"5\"><i></i><p class=\"sicon\"></p><span title=\"天坛西门\">天坛西门</span></div></li><li><div id=\"6m\"><i  class=\"busc\" clstag=\"5887\"></i></div></li><li><div id=\"6\"><i></i><p class=\"sicon\"></p><span title=\"大栅栏\">大栅栏</span></div></li><li><div id=\"7m\"><i ></i></div></li><li><div id=\"7\"><i></i><p class=\"sicon\"></p><span title=\"天安门广场东\">天安门广场东</span></div></li><li><div id=\"8m\"><i ></i></div></li><li><div id=\"8\"><i></i><p class=\"sicon\"></p><span title=\"天安门东\">天安门东</span></div></li><li><div id=\"9m\"><i  class=\"busc\" clstag=\"3826\"></i></div></li><li><div id=\"9\"><i></i><p class=\"sicon\"></p><span title=\"东华门\">东华门</span></div></li><li><div id=\"10m\"><i ></i></div></li><li><div id=\"10\"><i></i><p class=\"sicon\"></p><span title=\"北京妇产医院\">北京妇产医院</span></div></li><li><div id=\"11m\"><i ></i></div></li><li><div id=\"11\"><i></i><p class=\"sicon\"></p><span title=\"沙滩路口南\">沙滩路口南</span></div></li><li><div id=\"12m\"><i  class=\"busc\" clstag=\"649\"></i></div></li><li><div id=\"12\"><i></i><p class=\"sicon\"></p><span title=\"宽街路口南\" style=\"font-size: 16px;font-weight:700;\">宽街路口南</span></div></li></ul></div><div class=\"inquiry_footer\"><section><div class=\"inner\"><span class=\"buss\">途中车辆</span><span class=\"busc\">到站车辆</span></div></section></div>');\r\n\r\n    const list = $('.inquiry_main .fixed li');\r\n    let items = [];\r\n    list.each(function (i, element) {\r\n        const id = $(this).find('.sicon').parent().attr('id');\r\n        const item = $(this).find(`#${id}`);\r\n        const metre = item.parent().prev().find(`#${id}m`);\r\n\r\n        if (id) { // 确定 items 的条数 \r\n            items.push({\r\n                id: id,\r\n                name: item.find('span').attr('title'),\r\n                active: item.find('span').attr('style') ? 'active' : '',\r\n                isDZ: item.find('.buss').attr('clstag') == -1 ? true : false,\r\n                metre: metre.find('.busc').attr('clstag')\r\n            });\r\n        }\r\n    })\r\n\r\n\r\n    let data = {\r\n        numRoad: $('.inquiry_header #lh').text()\r\n        , numRoadDec: $('.inner #lm').text()\r\n        , numRoadDec2: $('.inner article').text()\r\n        , numRoadList: items\r\n    }\r\n    res.send(JSON.stringify(data));\r\n})\r\napp.listen(port)\r\nconsole.log(`Listening at http://localhost:${port}`)\r\n"]}